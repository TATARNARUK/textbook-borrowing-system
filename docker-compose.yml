version: '3.8'

services:
  # 1. ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Web Server (PHP + Apache)
  web:
    image: php:8.2-apache
    container_name: lib_web
    ports:
      - "8099:80"
    volumes:
      - ./src:/var/www/html
      - ./uploads:/var/www/html/uploads
      - ./php.ini:/usr/local/etc/php/conf.d/custom.ini
    networks:
      - lib-network
    # ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Extension ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
    command: >
      bash -c "docker-php-ext-install mysqli pdo pdo_mysql && docker-php-entrypoint apache2-foreground"

  # 2. ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Database (MySQL)
  db:
    image: mysql:8.0
    container_name: lib_db
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      # üî• ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö config.php
      MYSQL_DATABASE: vbrs
      MYSQL_USER: vbrs
      MYSQL_PASSWORD: bnccvbrs2026
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - lib-network

  # 3. ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Database (phpMyAdmin)
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: lib_pma
    links:
      - db
    ports:
      - "8083:80"
    environment:
      PMA_HOST: db
      MYSQL_ROOT_PASSWORD: rootpassword
    networks:
      - lib-network

networks:
  lib-network:

volumes:
  db_data: